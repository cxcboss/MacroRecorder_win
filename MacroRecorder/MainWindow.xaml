<Window x:Class="MacroRecorder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MacroRecorder"
        d:DataContext="{d:DesignInstance Type=local:ViewModels.MainViewModel}"
        mc:Ignorable="d"
        Title="宏录制器" Height="600" Width="800"
        WindowStartupLocation="CenterScreen">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="鼠标键盘行为录制器" FontSize="24" FontWeight="Bold" 
                       HorizontalAlignment="Center" Margin="0,0,0,10"/>
            
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Content="开始录制" Command="{Binding StartRecordingCommand}" 
                        IsEnabled="{Binding IsRecording, Converter={StaticResource InverseBoolConverter}}"
                        Width="100" Height="40" Margin="5" 
                        Style="{StaticResource PrimaryButton}"/>
                
                <Button Content="停止录制" Command="{Binding StopRecordingCommand}"
                        IsEnabled="{Binding IsRecording}"
                        Width="100" Height="40" Margin="5"
                        Style="{StaticResource DangerButton}"/>
            </StackPanel>
            
            <TextBlock Text="{Binding StatusMessage}" HorizontalAlignment="Center" 
                       Margin="0,5,0,0" Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>
        
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <GroupBox Grid.Column="0" Header="录制列表" Margin="0,0,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <ListView Grid.Row="0" ItemsSource="{Binding Recordings}" 
                              SelectedItem="{Binding CurrentRecording}"
                              Margin="0,0,0,5">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="名称" Width="200" 
                                                DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Header="时长" Width="80" 
                                                DisplayMemberBinding="{Binding TotalDuration, StringFormat=mm\\:ss}"/>
                                <GridViewColumn Header="操作数" Width="60" 
                                                DisplayMemberBinding="{Binding Actions.Count}"/>
                            </GridView>
                        </ListView.View>
                        <ListView.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="播放" Command="{Binding PlayCommand}" 
                                          CommandParameter="{Binding}"/>
                                <MenuItem Header="重命名" Command="{Binding RenameRecordingCommand}" 
                                          CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ListView}}"/>
                                <Separator/>
                                <MenuItem Header="删除" Command="{Binding DeleteRecordingCommand}" 
                                          CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ListView}}"/>
                            </ContextMenu>
                        </ListView.ContextMenu>
                    </ListView>
                    
                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Content="刷新" Command="{Binding RefreshRecordingsCommand}" 
                                Width="70" Height="30" Margin="5"/>
                        <Button Content="删除" Command="{Binding DeleteRecordingCommand}" 
                                CommandParameter="{Binding CurrentRecording}"
                                Width="70" Height="30" Margin="5"
                                Style="{StaticResource DangerButton}"
                                IsEnabled="{Binding CurrentRecording, Converter={StaticResource NullToBoolConverter}}"/>
                    </StackPanel>
                </Grid>
            </GroupBox>
            
            <GroupBox Grid.Column="1" Header="播放设置" Margin="5,0,0,0">
                <StackPanel Margin="10">
                    <TextBlock Text="播放设置" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <StackPanel Margin="0,5">
                        <RadioButton Content="播放一次" 
                                     IsChecked="{Binding InfiniteLoop, Converter={StaticResource InverseBoolConverter}}"/>
                        <RadioButton Content="无限循环" 
                                     IsChecked="{Binding InfiniteLoop}"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <TextBlock Text="播放次数:" VerticalAlignment="Center" 
                                   IsEnabled="{Binding InfiniteLoop, Converter={StaticResource InverseBoolConverter}}"/>
                        <TextBox Text="{Binding RepeatCount}" Width="60" Margin="10,0" 
                                 IsEnabled="{Binding InfiniteLoop, Converter={StaticResource InverseBoolConverter}}"/>
                    </StackPanel>
                    
                    <Border Height="1" Background="{StaticResource BorderBrush}" 
                            Margin="0,15,0,15"/>
                    
                    <TextBlock Text="当前选中录制" FontWeight="Bold" Margin="0,0,0,5"/>
                    <TextBlock Text="{Binding CurrentRecording.Name, TargetNullValue=未选中}" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <TextBlock Text="{Binding CurrentRecording.TotalDuration, StringFormat=时长: mm\\:ss, TargetNullValue=}" 
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                        <Button Content="播放" Command="{Binding PlayCommand}"
                                Width="100" Height="40" Margin="5"
                                Style="{StaticResource PrimaryButton}"
                                IsEnabled="{Binding CurrentRecording, Converter={StaticResource NullToBoolConverter}}"/>
                        
                        <Button Content="停止" Command="{Binding StopPlaybackCommand}"
                                Width="100" Height="40" Margin="5"
                                Style="{StaticResource DangerButton}"
                                IsEnabled="{Binding IsPlaying}"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                        <Button Content="重命名" Command="{Binding RenameRecordingCommand}"
                                CommandParameter="{Binding CurrentRecording}"
                                Width="80" Height="30" Margin="5"
                                IsEnabled="{Binding CurrentRecording, Converter={StaticResource NullToBoolConverter}}"/>
                    </StackPanel>
                </StackPanel>
            </GroupBox>
        </Grid>
        
        <StatusBar Grid.Row="2" Margin="0,10,0,0">
            <StatusBarItem Content="{Binding StatusMessage}"/>
        </StatusBar>
    </Grid>
</Window>
